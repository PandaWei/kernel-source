From: Jiri Slaby <jslaby@suse.cz>
Subject: sysfs: spectre_v2, handle spec_ctrl
Patch-mainline: never, SUSE specific
References: bsc#1075994 bsc#1075091

/sys/devices/system/cpu/vulnerabilities/spectre_v2 does no take into
account that we have IBRS+IBPB in our tree. Fix that.

Signed-off-by: Jiri Slaby <jslaby@suse.cz>
---
 arch/x86/kernel/cpu/bugs.c |    2 ++
 1 file changed, 2 insertions(+)

--- a/arch/x86/kernel/cpu/bugs.c
+++ b/arch/x86/kernel/cpu/bugs.c
@@ -671,6 +671,8 @@ static ssize_t cpu_show_common(struct de
 		return sprintf(buf, "Mitigation: __user pointer sanitization\n");
 
 	case X86_BUG_SPECTRE_V2:
+		if (boot_cpu_has(X86_FEATURE_SPEC_CTRL))
+			return sprintf(buf, "Mitigation: IBRS+IBPB\n");
 		return sprintf(buf, "%s%s%s%s\n", spectre_v2_strings[spectre_v2_enabled],
 			       boot_cpu_has(X86_FEATURE_USE_IBPB) ? ", IBPB" : "",
 			       boot_cpu_has(X86_FEATURE_USE_IBRS_FW) ? ", IBRS_FW" : "",
