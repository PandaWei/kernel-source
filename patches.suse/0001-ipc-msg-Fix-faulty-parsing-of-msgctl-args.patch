From b8dcc79f507f65b95fa568046ddcd61a2b0bc7e4 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Michal=20Koutn=C3=BD?= <mkoutny@suse.com>
Date: Fri, 18 May 2018 11:00:01 +0200
Subject: [PATCH] ipc/msg: Fix faulty parsing of msgctl args
References: bsc#1093600
References: bsc#1072689
Patch-mainline: Never, fixup of SUSE backport

We have adopted new MSG_STAT_ANY msgctl operation from upstream as part of
bsc#1072689 [1]. When we parse msgctl args, we want to match against this new
value similarly to MSG_STAT.

[1] 23c5cc798319e9a3bad708d739d3ffcf711c6939

Acked-by: Davidlohr Bueso <dbueso@suse.de>
Signed-off-by: Michal Koutn√Ω <mkoutny@suse.com>
---
 ipc/msg.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/ipc/msg.c b/ipc/msg.c
index 247a088dedfc..c9431e010ef7 100644
--- a/ipc/msg.c
+++ b/ipc/msg.c
@@ -528,7 +528,7 @@ SYSCALL_DEFINE3(msgctl, int, msqid, int, cmd, struct msqid_ds __user *, buf)
 		if (!buf)
 			return -EFAULT;
 
-		if (cmd == MSG_STAT || MSG_STAT_ANY) {
+		if (cmd == MSG_STAT || cmd == MSG_STAT_ANY) {
 			msq = msg_lock(ns, msqid);
 			if (IS_ERR(msq))
 				return PTR_ERR(msq);
-- 
2.13.6

