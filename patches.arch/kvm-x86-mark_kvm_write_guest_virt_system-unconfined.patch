from: Jiri Kosina <jkosiiiisuse.cz>
Subject: kvm: x86: mark kvm_write_guest_virt_system() as unconfined
Patch-mainline: not yet (under discussion)
References: bnc#1089343, CVE-2018-3646

Bring-in additional place where L1D should be flushed to be in-line
with upstream.

Reported-by: Nicolai Stange <nstange@suse.de>
Signed-off-by: Jiri Kosina <jkosina@suse.cz>
---
 arch/x86/kvm/x86.c |    3 +++
 1 file changed, 3 insertions(+)

--- a/arch/x86/kvm/x86.c
+++ b/arch/x86/kvm/x86.c
@@ -4098,6 +4098,9 @@ int kvm_write_guest_virt_system(struct x
 	void *data = val;
 	int r = X86EMUL_CONTINUE;
 
+	/* kvm_write_guest_virt_system can pull in tons of pages. */
+	vcpu->arch.vcpu_unconfined = true;
+
 	while (bytes) {
 		gpa_t gpa =  vcpu->arch.walk_mmu->gva_to_gpa(vcpu, addr,
 							     PFERR_WRITE_MASK,
