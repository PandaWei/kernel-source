From f2f2c85c66202edcb623626b3babce7850d8b4fb Mon Sep 17 00:00:00 2001
From: Dan Carpenter <dan.carpenter@oracle.com>
Date: Sat, 9 Dec 2017 14:46:13 +0300
Subject: drm: mali-dp: Uninitialized variable in malidp_se_check_scaling()
References: bsc#1087092
Patch-mainline: v4.16-rc1
Git-commit: f2f2c85c66202edcb623626b3babce7850d8b4fb

We use "mc" without initializing it if scaling is not necessary.

Changes during backport:

 * adapted patch to changes in patched context

Fixes: 28ce675b7474 ("drm: mali-dp: Add plane upscaling support")
Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
Reviewed-by: Mihail Atanassov <Mihail.Atanassov@arm.com>
Signed-off-by: Liviu Dudau <liviu.dudau@arm.com>
Acked-by: Thomas Zimmermann <tzimmermann@suse.de>
---
 drivers/gpu/drm/arm/malidp_planes.c |    4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

--- a/drivers/gpu/drm/arm/malidp_planes.c
+++ b/drivers/gpu/drm/arm/malidp_planes.c
@@ -149,6 +149,8 @@ static int malidp_se_check_scaling(struc
 	if (!crtc_state)
 		return -EINVAL;

+	mc = to_malidp_crtc_state(crtc_state);
+
 	clip.x2 = crtc_state->adjusted_mode.hdisplay;
 	clip.y2 = crtc_state->adjusted_mode.vdisplay;
 	ret = drm_plane_helper_check_state(state, &clip, 0, INT_MAX, true, true);
@@ -166,8 +168,6 @@ static int malidp_se_check_scaling(struc
 	if (mp->layer->id & (DE_SMART | DE_GRAPHICS2))
 		return -EINVAL;

-	mc = to_malidp_crtc_state(crtc_state);
-
 	mc->scaled_planes_mask |= mp->layer->id;
 	/* Defer scaling requirements calculation to the crtc check. */
 	return 0;
