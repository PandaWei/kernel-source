From: Jiri Slaby <jslaby@suse.cz>
Date: Wed, 8 Aug 2018 16:46:59 +0200
Subject: Revert "skbuff: Unconditionally copy pfmemalloc in __skb_clone()"
Patch-mainline: never, kabi
References: kabi

This reverts commit 80a80f51cc3aeea3d7d9d2b859357f611de7a87d, upstream
commit e78bfb0751d4e312699106ba7efbed2bab1a53ca. It fixes d629be850ac6
from 4.4.144 which will be reverted too.

Signed-off-by: Jiri Slaby <jslaby@suse.cz>
---
 net/core/skbuff.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/net/core/skbuff.c b/net/core/skbuff.c
index 55be076706e5..60ad04039d2a 100644
--- a/net/core/skbuff.c
+++ b/net/core/skbuff.c
@@ -828,7 +828,8 @@ static struct sk_buff *__skb_clone(struct sk_buff *n, struct sk_buff *skb)
 	n->cloned = 1;
 	n->nohdr = 0;
 	n->peeked = 0;
-	C(pfmemalloc);
+	if (skb->pfmemalloc)
+		n->pfmemalloc = 1;
 	n->destructor = NULL;
 	C(tail);
 	C(end);
-- 
2.18.0

