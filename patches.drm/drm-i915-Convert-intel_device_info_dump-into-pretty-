From eb10ed9a9e1ecacafab5535c86b62061b39360e5 Mon Sep 17 00:00:00 2001
From: Michal Wajdeczko <michal.wajdeczko@intel.com>
Date: Tue, 19 Dec 2017 11:43:45 +0000
Subject: [PATCH] drm/i915: Convert intel_device_info_dump into pretty printer
Git-commit: eb10ed9a9e1ecacafab5535c86b62061b39360e5
Patch-mainline: v4.16-rc1
References: FATE#322643 bsc#1055900

Convert intel_device_info_dump into pretty printer to be
consistent with the rest of the driver code.

Suggested-by: Chris Wilson <chris@chris-wilson.co.uk>
Signed-off-by: Michal Wajdeczko <michal.wajdeczko@intel.com>
Cc: Chris Wilson <chris@chris-wilson.co.uk>
Reviewed-by: Chris Wilson <chris@chris-wilson.co.uk>
Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
Link: https://patchwork.freedesktop.org/patch/msgid/20171219114346.26308-2-michal.wajdeczko@intel.com
Acked-by: Takashi Iwai <tiwai@suse.de>

---
 drivers/gpu/drm/i915/i915_drv.c          |    6 +++++-
 drivers/gpu/drm/i915/i915_drv.h          |    3 ++-
 drivers/gpu/drm/i915/intel_device_info.c |   22 ++++++++++------------
 3 files changed, 17 insertions(+), 14 deletions(-)

--- a/drivers/gpu/drm/i915/i915_drv.c
+++ b/drivers/gpu/drm/i915/i915_drv.c
@@ -930,7 +930,11 @@ static int i915_driver_init_early(struct
 
 	intel_display_crc_init(dev_priv);
 
-	intel_device_info_dump(dev_priv);
+	if (drm_debug & DRM_UT_DRIVER) {
+		struct drm_printer p = drm_debug_printer("i915 device info:");
+
+		intel_device_info_dump(&dev_priv->info, &p);
+	}
 
 	intel_detect_preproduction_hw(dev_priv);
 
--- a/drivers/gpu/drm/i915/i915_drv.h
+++ b/drivers/gpu/drm/i915/i915_drv.h
@@ -4119,7 +4119,8 @@ mkwrite_device_info(struct drm_i915_priv
 
 const char *intel_platform_name(enum intel_platform platform);
 void intel_device_info_runtime_init(struct drm_i915_private *dev_priv);
-void intel_device_info_dump(struct drm_i915_private *dev_priv);
+void intel_device_info_dump(const struct intel_device_info *info,
+			    struct drm_printer *p);
 void intel_device_info_dump_flags(const struct intel_device_info *info,
 				  struct drm_printer *p);
 
--- a/drivers/gpu/drm/i915/intel_device_info.c
+++ b/drivers/gpu/drm/i915/intel_device_info.c
@@ -77,21 +77,19 @@ void intel_device_info_dump_flags(const
 #undef PRINT_FLAG
 }
 
-void intel_device_info_dump(struct drm_i915_private *dev_priv)
+void intel_device_info_dump(const struct intel_device_info *info,
+			    struct drm_printer *p)
 {
-	const struct intel_device_info *info = &dev_priv->info;
+	struct drm_i915_private *dev_priv =
+		container_of(info, struct drm_i915_private, info);
 
-	DRM_DEBUG_DRIVER("i915 device info: platform=%s gen=%i pciid=0x%04x rev=0x%02x",
-			 intel_platform_name(info->platform),
-			 info->gen,
-			 dev_priv->drm.pdev->device,
-			 dev_priv->drm.pdev->revision);
+	drm_printf(p, "pciid=0x%04x rev=0x%02x platform=%s gen=%i\n",
+		   INTEL_DEVID(dev_priv),
+		   INTEL_REVID(dev_priv),
+		   intel_platform_name(info->platform),
+		   info->gen);
 
-	if (drm_debug & DRM_UT_DRIVER) {
-		struct drm_printer p = drm_debug_printer("i915 device info: ");
-
-		intel_device_info_dump_flags(info, &p);
-	}
+	intel_device_info_dump_flags(info, p);
 }
 
 static void gen10_sseu_info_init(struct drm_i915_private *dev_priv)
