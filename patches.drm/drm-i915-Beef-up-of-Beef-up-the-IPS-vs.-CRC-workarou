From 8bd719587d1215dad42d48d725eb1858987112c8 Mon Sep 17 00:00:00 2001
From: Marta Lofstedt <marta.lofstedt@intel.com>
Date: Mon, 28 Aug 2017 15:18:10 +0300
Subject: [PATCH] drm/i915: Beef up of Beef up the IPS vs. CRC workaround
Mime-version: 1.0
Content-type: text/plain; charset=UTF-8
Content-transfer-encoding: 8bit
Git-commit: 8bd719587d1215dad42d48d725eb1858987112c8
Patch-mainline: v4.15-rc1
References: FATE#322643 bsc#1055900

Commit 6e644626945c ("drm/i915: Beef up the IPS vs. CRC
workaround") was supposed to solve below bug. However, the
patch I tested is not the same as the one that got merged.
With this addition the test pass.

V2: removed unused: "struct intel_crtc *intel_crtc"

Fixes: 6e644626945c ("drm/i915: Beef up the IPS vs. CRC workaround")
Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=101664
Signed-off-by: Marta Lofstedt <marta.lofstedt@intel.com>
Signed-off-by: Ville Syrjälä <ville.syrjala@linux.intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20170828121810.13112-1-marta.lofstedt@intel.com
Acked-by: Takashi Iwai <tiwai@suse.de>

---
 drivers/gpu/drm/i915/intel_pipe_crc.c |    3 ---
 1 file changed, 3 deletions(-)

--- a/drivers/gpu/drm/i915/intel_pipe_crc.c
+++ b/drivers/gpu/drm/i915/intel_pipe_crc.c
@@ -919,7 +919,6 @@ int intel_crtc_set_crc_source(struct drm
 {
 	struct drm_i915_private *dev_priv = crtc->dev->dev_private;
 	struct intel_pipe_crc *pipe_crc = &dev_priv->pipe_crc[crtc->index];
-	struct intel_crtc *intel_crtc = to_intel_crtc(crtc);
 	enum intel_display_power_domain power_domain;
 	enum intel_pipe_crc_source source;
 	u32 val = 0; /* shut up gcc */
@@ -951,8 +950,6 @@ int intel_crtc_set_crc_source(struct drm
 		else if ((IS_HASWELL(dev_priv) ||
 			  IS_BROADWELL(dev_priv)) && crtc->index == PIPE_A)
 			hsw_pipe_A_crc_wa(dev_priv, false);
-
-		hsw_enable_ips(intel_crtc);
 	}
 
 	pipe_crc->skipped = 0;
