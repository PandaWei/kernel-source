From 8fb6a5df4612757d6aa4218750aa3ecaca609bd0 Mon Sep 17 00:00:00 2001
From: Chris Wilson <chris@chris-wilson.co.uk>
Date: Wed, 26 Jul 2017 19:16:02 +0100
Subject: [PATCH] drm/i915: Call the unlocked version of i915_gem_object_get_pages()
Git-commit: 8fb6a5df4612757d6aa4218750aa3ecaca609bd0
Patch-mainline: v4.14-rc1
References: FATE#322643 bsc#1055900

When we hold for the lock for swapping out the shmem pages for the
physically contiguous pages, we have to call the unlocked version of
get_pages!

Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=101934
Fixes: 35d23516946e ("drm/i915: Make i915_gem_object_phys_attach() use obj->mm.lock more appropriately")
Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
Link: https://patchwork.freedesktop.org/patch/msgid/20170726181602.23527-2-chris@chris-wilson.co.uk
Reviewed-by: Matthew Auld <matthew.auld@intel.com>
Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
Acked-by: Takashi Iwai <tiwai@suse.de>

---
 drivers/gpu/drm/i915/i915_gem.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/drivers/gpu/drm/i915/i915_gem.c
+++ b/drivers/gpu/drm/i915/i915_gem.c
@@ -5334,7 +5334,7 @@ int i915_gem_object_attach_phys(struct d
 	pages = obj->mm.pages;
 	obj->ops = &i915_gem_phys_ops;
 
-	err = __i915_gem_object_get_pages(obj);
+	err = ____i915_gem_object_get_pages(obj);
 	if (err)
 		goto err_xfer;
 
